# 内部文档 V2

暂定有四个页面（webpage），分别是welcome页面、home页面、帖子页面和用户页面。

2018.5.26

## welcome

welcome页面是打开网页后的内容（相当于bbs的登录页面），包含一个大logo，一个用户id输入框，一个用户密码输入框，一个注册按钮，一个登录按钮，一个游客按钮。

点击注册按钮后，浏览器向服务器发送一个json字符串，格式是{‘id’: ‘xxx’, ‘pwd’:’xxx’}，后期实现可以用RSA算法对id和pwd进行加密。然后会刷新页面，等待服务器返回一个json字符串表示注册成功或失败。格式为{‘status’: 0/1}，0表示成功，1表示失败。

点击登录按钮后，浏览器发送和上面一样的json字符串，并等待服务器返回一个json字符串表示登录成功或失败，格式和意义和上面一样。登录成功则自动跳转到home页面。

点击游客按钮后，浏览器发送json字符串，格式为{‘mac’:’xxxxx’}发送mac地址，然后登录成功进入home页面。

注意：后两个按钮发送服务器数据后需要服务器建立一个会话并且返回一个cookie标识。

## home

home页面，页面最上方，左边是logo，右边是用户名字，点**击可以进入用户页面（跳转到`user.html?uid=xxx`）**。下面的主体是按照某种规则排序的十条帖子。这十条帖子是浏览器通过get请求向服务器获得的。请求的参数为page=1（表示第一页，前十条），**具体请求可以是`home.html?page=xxx`**

**服务器记录总帖子数，以便返回总页数。**

然后服务器返回一个json字符串，格式为

```json
{
	"status": 0,
	"data":[
        {
            "title": "【FOR 葛格1】主人，精致的宠物猪猪，要不要领养一只",
            "text": "这是一只有些精致的宠物猪猪，喜欢打扮自己的男孩子要不要领养一只呢？...",
            "view": 322,
            "re": 79,
            "post": "2018-05-20 16:40:23",
            "last": "2018-05-21 00:38:11",
            "pid": "dorisxiaoyao",
            "lid": "dorisxiaoyao",
            "tid": "16421013"
        }
     ]
}
```

status表示状态，0表示无误，1表示有问题；data是个数组，数组的每个元素含有：title表示帖子标题、**text表示帖子一楼的前若干字符?**、view表示浏览数量、re表示跟帖数量、post表示发帖时间、last表示最后回帖时间、pid表示发帖人id、lid表示最后回复用户id、tid表示帖子id。**点击`tid`，发出请求：`thread.html?tid=xxx`**

这个页面最下方还有一个发布新帖的文本框和选项。发送新帖后浏览器会给**服务器`thread.html?`发送一个json字符串**，格式是 

```
var new_post = {
	"title": $("#post-title").val(),
	"text": $("#post-text").val(),
	"pid": "pid",  // needs server
	"time": Date()
}
```

分别是帖子标题，发帖内容，发帖人id，发帖时间。

 **希望服务器返回result.tid，这样home页面跳转到`thread.html?tid=`+result.tid**

**帖子按键值排序?sort=0/1/2/3**

## user

用户页面，页面最上方和home一样。主要的内容是显示用户的发帖纪录。同样靠浏览器发送请求实现，具体请求可以是**`xxx(域名)/user.html?uid=xxxx&page=1`**

服务器返回一个json字符串，内容和上面的大同小异，其中data数组的元素需要改成

```json
{
	"status": 0,
	"data":[
        {
            "title": "【FOR 葛格】主人，精致的宠物猪猪，要不要领养一只",
            "text": "信息太少了，身高体重家乡什么都没有吗。。除了大概能猜到是95年属猪另外香港/日本游征人了解一下，同毕业狗有兴趣吗",
            "view": 322,
            "re": 79,
            "post": "2018-05-20 16:40:23",
            "time": "2018-05-20 17:52:27",
            "pid": "dorisxiaoyao",
            "tid": "16421013"
        }
    ]
}
```

title表示在这个标题的帖子下发帖，text表示发送内容，tid表示帖子id，time表示发送时间。

## thread 

帖子页面，页面最上方（同上）。然后次上方是帖子标题。显示各个帖子。需要解析alice、bob等内容。还是通过浏览器的请求，格式为`xxx(域名)/thread?tid=xxx&page=1`

服务器返回一个json字符串，格式大同小异，其中data数组的元素改成

```son
{
	"status":0,
	"page_num":100, 
	"data":[
      "text":
      "time":
      "id": "Alice",
      "fid": 5 # 第几层
	]
}
```

意思分别是，某一楼的内容，发帖时间，发帖人id，楼id。

服务器记录帖子总数。

这个页面还要实现一个对某一楼的回帖功能（或者不用，直接1楼、2楼、3楼，没有回复关系），发送给服务器的json数据格式为

```
{
      "text":
      "id": "userid", # 用户id
      "tid": "16421013"
}
```

意思分别是回复某一楼的id、用户id、回复文本、回复时间。

最后说一句：帖子id和楼id是分开编码的，而且均是全站唯一（可以按照发帖顺序编码）。比如帖子1的第一楼的楼id是1，二楼的楼id是2。然后有人发了帖子2，则帖子2的第一楼的id就是3。 

to do list:

1.  中期报告明天晚上8点。分工overleaf。
2.  细节：`home.html` text截断，sort排序。personal按钮改成用户名。去掉`user.html`的learn more。`thread.html`回复text加上`Re:Alice`。
3.  写一个`about.html`.
4.  部署到服务器上。
5.  核心功能：用户名+密码 加密。
6.  更多功能：上传txt post，语音，图片，视频，支持多种格式。点赞，分区，异常流量检测











 